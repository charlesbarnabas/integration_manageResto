<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Inventory Service</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div class="container modern-container">
        <h1 class="main-title">Inventory List</h1>

        <div class="table-responsive">
            <table id="inventory-table" class="modern-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nama</th>
                        <th>Jumlah</th>
                        <th>Unit</th>
                    </tr>
                </thead>
                <tbody id="inventory-body"></tbody>
            </table>
        </div>

        <div class="card">
            <h2>Tambah Item Baru</h2>
            <form id="add-form">
                <div class="form-group">
                    <input type="text" id="name" placeholder="Nama" required>
                    <input type="number" id="quantity" placeholder="Jumlah" required>
                    <input type="text" id="unit" placeholder="Unit" required>
                    <button type="submit" class="btn-primary">âž• Tambah</button>
                </div>
            </form>
        </div>

        <div class="card">
            <h2>Update Jumlah Item</h2>
            <form id="update-form">
                <div class="form-group">
                    <input type="number" id="update-id" placeholder="ID" required>
                    <input type="number" id="update-quantity" placeholder="Jumlah Baru" required>
                    <button type="submit" class="btn-secondary">ðŸ”„ Update</button>
                </div>
            </form>
        </div>
        <div id="notification" class="notification" style="display:none;"></div>
    </div>

    <script>
        const endpoint = "/graphql";

        async function loadInventory() {
            const query = {
                query: `
                {
                    allItems {
                        id
                        name
                        quantity
                        unit
                    }
                }`
            };

            const res = await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(query)
            });

            const result = await res.json();
            const items = result.data.allItems;
            const tbody = document.getElementById("inventory-body");
            tbody.innerHTML = "";

            items.forEach(item => {
                const row = `<tr>
                    <td>${item.id}</td>
                    <td>${item.name}</td>
                    <td>${item.quantity}</td>
                    <td>${item.unit}</td>
                </tr>`;
                tbody.innerHTML += row;
            });
        }

        document.getElementById("add-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const name = document.getElementById("name").value;
            const quantity = parseInt(document.getElementById("quantity").value);
            const unit = document.getElementById("unit").value;

            const mutation = {
                query: `
                mutation {
                    createInventoryItem(name: "${name}", quantity: ${quantity}, unit: "${unit}") {
                        item {
                            id
                        }
                    }
                }`
            };

            await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(mutation)
            });

            e.target.reset();
            loadInventory();
            showNotification("Item berhasil ditambah!");
        });

        document.getElementById("update-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const id = parseInt(document.getElementById("update-id").value);
            const quantity = parseInt(document.getElementById("update-quantity").value);

            const mutation = {
                query: `
                mutation {
                    updateInventoryItem(id: ${id}, quantity: ${quantity}) {
                        item {
                            id
                        }
                    }
                }`
            };

            await fetch(endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(mutation)
            });

            e.target.reset();
            loadInventory();
            showNotification("Item berhasil diupdate!");
        });

        function showNotification(message, success=true) {
            const notif = document.getElementById("notification");
            notif.style.display = "block";
            notif.style.background = success ? "#e0ffe0" : "#ffe0e0";
            notif.style.color = success ? "#2c662d" : "#b32d2d";
            notif.textContent = message;
            setTimeout(() => notif.style.display = "none", 2000);
        }

        loadInventory();
    </script>
</body>
</html>
